generator client {
  provider      = "prisma-client-js"
  output        = "../app/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./ERD.svg"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  mobile    String   @unique
  plan      String   @default("free")
  birthDate String
  email     String?  @unique
  records   Record[]
  reels     Reel[]
}

model Reel {
  id            Int            @id @default(autoincrement())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  identifier    String         @unique
  name          String
  birthDate     String
  profileImg    String?
  birthPlace    String?
  motto         String?
  lifestoryId   Int?
  userId        Int?
  lifestory     Lifestory?
  memorys       Memory[]
  user          User?          @relation(fields: [userId], references: [id])
  relationships Relationship[]
  childhood     WheelTexture[]
}

model Lifestory {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  tokenUsage Int      @default(0)
  mood       String?
  qaCount    Int?
  qaList     Json?
  result     String?
  reelId     Int      @unique
  reel       Reel     @relation(fields: [reelId], references: [id])
}

model WheelTexture {
  id             Int           @id @default(autoincrement())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  srcType        Int
  srcUrl         String
  memoryId       Int?
  relationshipId Int?
  caption        String?
  reelId         Int?
  memory         Memory?       @relation(fields: [memoryId], references: [id])
  reels          Reel?         @relation(fields: [reelId], references: [id])
  relationship   Relationship? @relation(fields: [relationshipId], references: [id])
}

model Memory {
  id            Int            @id @default(autoincrement())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  title         String
  subTitle      String?
  date          DateTime?
  comment       String?
  reelId        Int
  reel          Reel           @relation(fields: [reelId], references: [id])
  wheelTextures WheelTexture[]
}

model Relationship {
  id            Int            @id @default(autoincrement())
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  name          String
  relation      String
  comment       String?
  reelId        Int?
  reels         Reel?          @relation(fields: [reelId], references: [id])
  wheelTextures WheelTexture[]
}

model Record {
  id          Int          @id @default(autoincrement())
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  identifier  String       @unique
  coverUrl    String?
  name        String?
  subName     String?
  description String?
  bgm         String?
  color       String?
  userId      Int?
  userName    String?
  birthDate   String?
  displayMode String?      @default("year")
  user        User?        @relation(fields: [userId], references: [id])
  recordItems RecordItem[]
}

model RecordItem {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  title       String?
  date        String?
  location    String?
  description String?
  color       String?
  isHighlight Boolean  @default(false)
  coverUrl    String? // 하위 호환성을 위해 유지 (첫 번째 이미지)
  images      String[] @default([]) // 최대 5개 이미지 배열
  recordId    Int
  record      Record   @relation(fields: [recordId], references: [id])
}
