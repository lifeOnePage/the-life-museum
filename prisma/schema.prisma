// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./ERD.svg" // png, svg, md 등 가능
  // theme = "light"      // 옵션
  // relationships = true // 기본 true
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  mobile    String    @unique
  birthDate String
  email     String?   @unique
  plan      String    @default("free")
  reels     Reels[]
  records   Records[]
}

model Reels {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  identifier String @unique

  name       String
  birthDate  String
  profileImg String?
  birthPlace String?
  motto      String?

  lifestory   Lifestory?
  lifestoryId Int?

  User   User? @relation(fields: [userId], references: [id])
  userId Int?

  childhood    WheelTexture[]
  memory       Memory[]
  relationship Relationship[]
}

model Lifestory {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tokenUsage Int     @default(0)
  mood       String?
  qaCount    Int?
  qaList     Json?
  result     String?
  reels      Reels   @relation(fields: [reelsId], references: [id])
  reelsId    Int     @unique
}

model WheelTexture {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  srcType Int
  srcUrl  String

  caption String?

  Memory         Memory?       @relation(fields: [memoryId], references: [id])
  memoryId       Int?
  Relationship   Relationship? @relation(fields: [relationshipId], references: [id])
  relationshipId Int?
  Reels          Reels?        @relation(fields: [reelsId], references: [id])
  reelsId        Int?
}

model Memory {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title        String
  subTitle     String?
  date         DateTime?
  comment      String?
  WheelTexture WheelTexture[]
  reels        Reels?         @relation(fields: [reelsId], references: [id])
  reelsId      Int
}

model Relationship {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name         String
  relation     String
  comment      String?
  WheelTexture WheelTexture[]

  Reels   Reels? @relation(fields: [reelsId], references: [id])
  reelsId Int?
}

model Records {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  identifier String @unique

  name      String
  birthDate DateTime
  User      User?    @relation(fields: [userId], references: [id])
  userId    Int?
  events    Event[]
}

model Event {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Records   Records? @relation(fields: [recordsId], references: [id])
  recordsId Int?
  title     String
}
